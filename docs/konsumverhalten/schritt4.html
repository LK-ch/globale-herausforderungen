<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schritt 4: Nachhaltiges Konsumverhalten</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fbbf24 0%, #fb923c 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .lesson-header {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
            color: white;
            padding: 40px;
            border-radius: 20px 20px 0 0;
        }

        .lesson-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .lesson-content {
            padding: 40px;
            line-height: 1.8;
        }

        .info-box {
            background: #fef3c7;
            border-left: 4px solid #fb923c;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .info-box p {
            color: #78350f;
        }

        h2 {
            color: #f97316;
            margin: 30px 0 15px 0;
            font-size: 1.6em;
        }

        .btn-back-header {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border: 2px solid white;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-block;
            text-decoration: none;
            margin-bottom: 20px;
        }

        .btn-back-header:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* Sustainability Aspects Table */
        .sustainability-table {
            background: white;
            border: 3px solid #fb923c;
            border-radius: 12px;
            overflow: hidden;
            margin: 20px 0;
        }

        .sustainability-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .sustainability-table th {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-size: 1.1em;
        }

        .sustainability-table td {
            padding: 15px;
            border-bottom: 1px solid #fde68a;
            color: #78350f;
        }

        .sustainability-table tr:last-child td {
            border-bottom: none;
        }

        .aspect-title {
            font-weight: bold;
            color: #f97316;
            width: 200px;
        }

        /* Situation Cards */
        .situation-container {
            background: #fff7ed;
            border: 3px solid #fb923c;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }

        .situation-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .situation-number {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
            color: white;
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .situation-emoji {
            font-size: 3em;
            text-align: center;
            margin: 20px 0;
        }

        .situation-text {
            font-size: 1.15em;
            font-weight: bold;
            color: #78350f;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .journal-section {
            background: #fef3c7;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .journal-section h4 {
            color: #f97316;
            margin-bottom: 10px;
        }

        .journal-textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #fde68a;
            border-radius: 8px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1em;
            resize: vertical;
            margin: 10px 0;
        }

        .journal-textarea:focus {
            outline: none;
            border-color: #fb923c;
            box-shadow: 0 0 10px rgba(251, 146, 60, 0.2);
        }

        /* Option Selection */
        .option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .option-card {
            background: white;
            border: 3px solid #fde68a;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .option-card:hover {
            border-color: #fb923c;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(251, 146, 60, 0.3);
        }

        .option-card.selected {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-color: #fb923c;
            border-width: 4px;
        }

        .option-title {
            font-weight: bold;
            color: #f97316;
            margin: 10px 0;
            font-size: 1.1em;
        }

        .option-description {
            color: #78350f;
            font-size: 0.95em;
            line-height: 1.4;
        }

        /* Sustainability Badges */
        .sustainability-badges {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .badge.ecological {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }

        .badge.economic {
            background: #dbeafe;
            color: #1e40af;
            border: 2px solid #3b82f6;
        }

        .badge.social {
            background: #fce7f3;
            color: #9f1239;
            border: 2px solid #ec4899;
        }

        .badge.inactive {
            background: #f3f4f6;
            color: #9ca3af;
            border: 2px solid #d1d5db;
            opacity: 0.5;
        }

        /* Feedback Box */
        .feedback-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #fb923c;
            display: none;
        }

        .feedback-box.show {
            display: block;
        }

        .feedback-box h4 {
            color: #f97316;
            margin-bottom: 10px;
        }

        .feedback-box p {
            color: #78350f;
            line-height: 1.6;
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        button:hover {
            transform: scale(1.05);
        }

        .btn-back {
            background: #f5f5f5;
            color: #333;
        }

        .btn-complete {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
            color: white;
        }

        .btn-pdf {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .btn-save {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-analyze {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            width: 100%;
            margin-top: 15px;
        }

        .saved-indicator {
            color: #f97316;
            font-weight: bold;
            display: none;
            margin-top: 10px;
        }

        /* Score Display */
        .progress-box {
            background: white;
            border: 3px solid #fb923c;
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
        }

        .progress-box h3 {
            color: #f97316;
            margin-bottom: 10px;
        }

        .progress-number {
            font-size: 2em;
            font-weight: bold;
            color: #fb923c;
        }

        @media (max-width: 768px) {
            .lesson-header h1 {
                font-size: 1.8em;
            }

            .lesson-content {
                padding: 20px;
            }

            .option-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="lesson-header">
            <button class="btn-back-header" onclick="returnToMain()">â† ZurÃ¼ck zur Ãœbersicht</button>
            <h1>ğŸ›’ Nachhaltiges Konsumverhalten</h1>
        </div>

        <div class="lesson-content">
            <div class="info-box">
                <p><strong>ğŸ¯ Ziel:</strong> Lernen Sie, nachhaltige Kaufentscheidungen zu treffen, die Ã¶kologische, Ã¶konomische und soziale Aspekte berÃ¼cksichtigen.</p>
            </div>

            <h2>ğŸ“Š Die drei Aspekte der Nachhaltigkeit</h2>

            <div class="sustainability-table">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2">Aspekte der Nachhaltigkeit</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="aspect-title">ğŸŒ¿ Ã–kologische Nachhaltigkeit</td>
                            <td>Die Natur und die Umwelt sollen fÃ¼r die nachkommenden Generationen erhalten bleiben. <em>Beispiele:</em> Artenvielfalt, Klimaschutz, schonender Umgang mit der natÃ¼rlichen Umgebung</td>
                        </tr>
                        <tr>
                            <td class="aspect-title">ğŸ’° Ã–konomische Nachhaltigkeit</td>
                            <td>Die Wirtschaft soll so angelegt sein, dass sie dauerhaft eine tragfÃ¤hige Grundlage fÃ¼r Erwerb und Wohlstand bietet. <em>Beispiele:</em> Schutz der Ressourcen vor Ausbeutung, Schaffung von ArbeitsplÃ¤tzen</td>
                        </tr>
                        <tr>
                            <td class="aspect-title">ğŸ‘¥ Soziale Nachhaltigkeit</td>
                            <td>Die Gesellschaft soll sich so entwickeln, dass alle Mitglieder der Gemeinschaft an dieser Entwicklung teilhaben kÃ¶nnen. <em>Beispiele:</em> sozialer Ausgleich, lebenswerte Gesellschaft fÃ¼r alle</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>ğŸ’­ Ihre Kaufsituationen</h2>

            <div class="situation-container">
                <!-- Situation 1: Smartphone -->
                <div class="situation-card" id="situation-1">
                    <span class="situation-number">Situation 1</span>
                    <div class="situation-emoji">ğŸ“±</div>
                    <div class="situation-text">
                        Ihr Smartphone macht nicht mehr die besten Fotos und der Akku hÃ¤lt nur noch kurz. Sie Ã¼berlegen sich, was Sie tun kÃ¶nnen.
                    </div>

                    <div class="journal-section">
                        <h4>1. Ihre erste Idee: Was fÃ¤llt Ihnen spontan ein?</h4>
                        <textarea class="journal-textarea" id="s1-idea" placeholder="Notieren Sie Ihre erste Idee..." oninput="autoSave()"></textarea>
                    </div>

                    <div class="journal-section">
                        <h4>2. WÃ¤hlen Sie eine Option und analysieren Sie deren Nachhaltigkeit:</h4>
                        <div class="option-grid">
                            <div class="option-card" onclick="selectOption(1, 'neu')">
                                <div class="option-title">ğŸ“¦ Neues Smartphone kaufen</div>
                                <div class="option-description">Das neueste Modell mit bester Kamera</div>
                            </div>
                            <div class="option-card" onclick="selectOption(1, 'guenstig')">
                                <div class="option-title">ğŸ’¸ GÃ¼nstiges neues GerÃ¤t</div>
                                <div class="option-description">Budget-Smartphone, 200-300 CHF</div>
                            </div>
                            <div class="option-card" onclick="selectOption(1, 'reparieren')">
                                <div class="option-title">ğŸ”§ Reparieren lassen</div>
                                <div class="option-description">Akku wechseln, eventuell Kamera reparieren</div>
                            </div>
                            <div class="option-card" onclick="selectOption(1, 'secondhand')">
                                <div class="option-title">â™»ï¸ Gebrauchtes GerÃ¤t</div>
                                <div class="option-description">Second-Hand oder refurbished kaufen</div>
                            </div>
                            <div class="option-card" onclick="selectOption(1, 'fairphone')">
                                <div class="option-title">ğŸŒ Fairphone</div>
                                <div class="option-description">Nachhaltiges, reparierbares Smartphone</div>
                            </div>
                        </div>

                        <div class="feedback-box" id="feedback-1"></div>

                        <button class="btn-analyze" onclick="analyzeChoice(1)" id="analyze-1">Meine Wahl analysieren</button>
                    </div>

                    <div class="journal-section">
                        <h4>3. Ihre Reflexion: Was haben Sie Ã¼ber nachhaltige Alternativen gelernt?</h4>
                        <textarea class="journal-textarea" id="s1-reflection" placeholder="Was wÃ¼rden Sie jetzt tun? Welche Aspekte der Nachhaltigkeit sind Ihnen wichtig?" oninput="autoSave()"></textarea>
                    </div>
                </div>

                <!-- Situation 2: Kleidung -->
                <div class="situation-card" id="situation-2">
                    <span class="situation-number">Situation 2</span>
                    <div class="situation-emoji">ğŸ§¥</div>
                    <div class="situation-text">
                        Sie sehen in einem GeschÃ¤ft eine schicke Jacke, die Ihnen sehr gut gefÃ¤llt. Sie Ã¼berlegen, ob und wie Sie diese Jacke bekommen kÃ¶nnen.
                    </div>

                    <div class="journal-section">
                        <h4>1. Ihre erste Idee:</h4>
                        <textarea class="journal-textarea" id="s2-idea" placeholder="Was wÃ¼rden Sie spontan tun?" oninput="autoSave()"></textarea>
                    </div>

                    <div class="journal-section">
                        <h4>2. WÃ¤hlen Sie eine Option:</h4>
                        <div class="option-grid">
                            <div class="option-card" onclick="selectOption(2, 'fastfashion')">
                                <div class="option-title">ğŸƒ Fast Fashion kaufen</div>
                                <div class="option-description">GÃ¼nstig bei H&M, Zara, Shein</div>
                            </div>
                            <div class="option-card" onclick="selectOption(2, 'marke')">
                                <div class="option-title">âœ¨ Marken-Jacke</div>
                                <div class="option-description">Teuer, gute QualitÃ¤t, lange haltbar</div>
                            </div>
                            <div class="option-card" onclick="selectOption(2, 'brockenstube')">
                                <div class="option-title">ğŸª Brockenstube</div>
                                <div class="option-description">Second-Hand kaufen</div>
                            </div>
                            <div class="option-card" onclick="selectOption(2, 'tausch')">
                                <div class="option-title">ğŸ”„ Kleidertausch</div>
                                <div class="option-description">Mit Freunden tauschen oder TauschbÃ¶rse</div>
                            </div>
                            <div class="option-card" onclick="selectOption(2, 'fairtrade')">
                                <div class="option-title">ğŸŒ± Fair Trade Mode</div>
                                <div class="option-description">Bio-Baumwolle, faire Arbeitsbedingungen</div>
                            </div>
                        </div>

                        <div class="feedback-box" id="feedback-2"></div>
                        <button class="btn-analyze" onclick="analyzeChoice(2)" id="analyze-2">Meine Wahl analysieren</button>
                    </div>

                    <div class="journal-section">
                        <h4>3. Ihre Reflexion:</h4>
                        <textarea class="journal-textarea" id="s2-reflection" placeholder="Was haben Sie gelernt?" oninput="autoSave()"></textarea>
                    </div>
                </div>

                <!-- Situation 3: Putzmittel -->
                <div class="situation-card" id="situation-3">
                    <span class="situation-number">Situation 3</span>
                    <div class="situation-emoji">ğŸ§¼</div>
                    <div class="situation-text">
                        Sie mÃ¶chten im Haushalt putzen und brauchen Reinigungsmittel. Welche Option wÃ¤hlen Sie?
                    </div>

                    <div class="journal-section">
                        <h4>1. Ihre erste Idee:</h4>
                        <textarea class="journal-textarea" id="s3-idea" placeholder="Welche Putzmittel wÃ¼rden Sie kaufen?" oninput="autoSave()"></textarea>
                    </div>

                    <div class="journal-section">
                        <h4>2. WÃ¤hlen Sie eine Option:</h4>
                        <div class="option-grid">
                            <div class="option-card" onclick="selectOption(3, 'standard')">
                                <div class="option-title">ğŸ§´ Standard-Putzmittel</div>
                                <div class="option-description">GÃ¼nstig im Supermarkt, in Plastikflaschen</div>
                            </div>
                            <div class="option-card" onclick="selectOption(3, 'marke-plastik')">
                                <div class="option-title">âœ¨ Markenprodukt</div>
                                <div class="option-description">Teurer, gute Wirkung, Plastikverpackung</div>
                            </div>
                            <div class="option-card" onclick="selectOption(3, 'bio')">
                                <div class="option-title">ğŸŒ¿ Bio-Putzmittel</div>
                                <div class="option-description">Biologisch abbaubar, ohne Plastik</div>
                            </div>
                            <div class="option-card" onclick="selectOption(3, 'refill')">
                                <div class="option-title">â™»ï¸ NachfÃ¼llstation</div>
                                <div class="option-description">Eigene Flasche auffÃ¼llen, Unverpackt-Laden</div>
                            </div>
                            <div class="option-card" onclick="selectOption(3, 'selbst')">
                                <div class="option-title">ğŸ  Selbst herstellen</div>
                                <div class="option-description">Mit Essig, Natron, ZitronensÃ¤ure</div>
                            </div>
                        </div>

                        <div class="feedback-box" id="feedback-3"></div>
                        <button class="btn-analyze" onclick="analyzeChoice(3)" id="analyze-3">Meine Wahl analysieren</button>
                    </div>

                    <div class="journal-section">
                        <h4>3. Ihre Reflexion:</h4>
                        <textarea class="journal-textarea" id="s3-reflection" placeholder="Was haben Sie gelernt?" oninput="autoSave()"></textarea>
                    </div>
                </div>

                <!-- Situation 4: Festtagsessen -->
                <div class="situation-card" id="situation-4">
                    <span class="situation-number">Situation 4</span>
                    <div class="situation-emoji">ğŸ½ï¸</div>
                    <div class="situation-text">
                        Sie planen ein leckeres Festtagsessen fÃ¼r Ihre Familie. Was kommt auf den Tisch?
                    </div>

                    <div class="journal-section">
                        <h4>1. Ihre erste Idee:</h4>
                        <textarea class="journal-textarea" id="s4-idea" placeholder="Was wÃ¼rden Sie kochen?" oninput="autoSave()"></textarea>
                    </div>

                    <div class="journal-section">
                        <h4>2. WÃ¤hlen Sie eine Option:</h4>
                        <div class="option-grid">
                            <div class="option-card" onclick="selectOption(4, 'steak')">
                                <div class="option-title">ğŸ¥© Argentinisches Steak</div>
                                <div class="option-description">Importiertes Rindfleisch</div>
                            </div>
                            <div class="option-card" onclick="selectOption(4, 'bio-fleisch')">
                                <div class="option-title">ğŸ„ Bio-Fleisch regional</div>
                                <div class="option-description">Vom lokalen Bauernhof</div>
                            </div>
                            <div class="option-card" onclick="selectOption(4, 'fisch')">
                                <div class="option-title">ğŸŸ Fisch</div>
                                <div class="option-description">Lachs oder Forelle</div>
                            </div>
                            <div class="option-card" onclick="selectOption(4, 'vegetarisch')">
                                <div class="option-title">ğŸ¥— Vegetarisches MenÃ¼</div>
                                <div class="option-description">Mit lokalem GemÃ¼se und KÃ¤se</div>
                            </div>
                            <div class="option-card" onclick="selectOption(4, 'vegan')">
                                <div class="option-title">ğŸŒ± Veganes Festessen</div>
                                <div class="option-description">Rein pflanzlich, regional und saisonal</div>
                            </div>
                        </div>

                        <div class="feedback-box" id="feedback-4"></div>
                        <button class="btn-analyze" onclick="analyzeChoice(4)" id="analyze-4">Meine Wahl analysieren</button>
                    </div>

                    <div class="journal-section">
                        <h4>3. Ihre Reflexion:</h4>
                        <textarea class="journal-textarea" id="s4-reflection" placeholder="Was haben Sie gelernt?" oninput="autoSave()"></textarea>
                    </div>
                </div>
            </div>

            <div class="progress-box">
                <h3>Ihr Fortschritt</h3>
                <div class="progress-number" id="progressDisplay">0 / 4 Situationen analysiert</div>
            </div>

            <div class="button-group">
                <button class="btn-back" onclick="returnToMain()">
                    â† ZurÃ¼ck zur Ãœbersicht
                </button>
                <button class="btn-pdf" onclick="downloadPDF()">
                    ğŸ“„ PDF herunterladen
                </button>
                <button class="btn-complete" onclick="completeStep()">
                    Schritt abschlieÃŸen und weiter â†’
                </button>
            </div>
        </div>
    </div>

    <script>
        let selectedOptions = {};
        let analyzedCount = 0;

        const optionData = {
            1: { // Smartphone
                'neu': {
                    badges: ['economic'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Neues Smartphone</h4><p><strong>âœ“ Ã–konomisch:</strong> UnterstÃ¼tzt Wirtschaft und ArbeitsplÃ¤tze</p><p><strong>âœ— Ã–kologisch:</strong> Hoher Ressourcenverbrauch, Elektroschrott, COâ‚‚-Emissionen bei Produktion</p><p><strong>âœ— Sozial:</strong> Oft problematische Arbeitsbedingungen in der Produktion</p><p><em>ğŸ’¡ Tipp: Ein Smartphone zu reparieren spart ca. 50kg COâ‚‚ im Vergleich zum Neukauf!</em></p>'
                },
                'guenstig': {
                    badges: ['economic'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: GÃ¼nstiges Smartphone</h4><p><strong>âœ“ Ã–konomisch:</strong> KostengÃ¼nstig, erschwinglich</p><p><strong>âœ— Ã–kologisch:</strong> Oft kÃ¼rzere Lebensdauer, mehr Elektroschrott</p><p><strong>âœ— Sozial:</strong> HÃ¤ufig schlechte Produktionsbedingungen</p><p><em>ğŸ’¡ Bedenken Sie: GÃ¼nstige GerÃ¤te halten oft nur 1-2 Jahre und mÃ¼ssen dann ersetzt werden.</em></p>'
                },
                'reparieren': {
                    badges: ['ecological', 'economic'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Reparatur</h4><p><strong>âœ“âœ“ Ã–kologisch:</strong> Keine neuen Ressourcen nÃ¶tig, weniger Elektroschrott, geringer COâ‚‚-FuÃŸabdruck</p><p><strong>âœ“ Ã–konomisch:</strong> Oft gÃ¼nstiger als Neukauf, lokale Reparaturbetriebe werden unterstÃ¼tzt</p><p><strong>~ Sozial:</strong> UnterstÃ¼tzt lokales Handwerk</p><p><em>ğŸ’¡ Sehr gute Wahl! Reparieren ist fast immer die nachhaltigste Option.</em></p>'
                },
                'secondhand': {
                    badges: ['ecological', 'economic', 'social'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Second-Hand GerÃ¤t</h4><p><strong>âœ“âœ“ Ã–kologisch:</strong> Keine Neuproduktion, verlÃ¤ngerte Lebensdauer, reduzierter Elektroschrott</p><p><strong>âœ“ Ã–konomisch:</strong> GÃ¼nstiger Preis, gutes Preis-Leistungs-VerhÃ¤ltnis</p><p><strong>âœ“ Sozial:</strong> FÃ¶rdert Kreislaufwirtschaft und soziale Projekte (wenn Ã¼ber gemeinnÃ¼tzige Organisationen)</p><p><em>ğŸ’¡ Exzellente Wahl! Refurbished GerÃ¤te sind oft wie neu und sparen bis zu 70% COâ‚‚.</em></p>'
                },
                'fairphone': {
                    badges: ['ecological', 'economic', 'social'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Fairphone</h4><p><strong>âœ“âœ“ Ã–kologisch:</strong> Langlebig, reparierbar, recycelte Materialien</p><p><strong>âœ“ Ã–konomisch:</strong> HÃ¶herer Anschaffungspreis, aber langfristig gÃ¼nstiger durch Reparierbarkeit</p><p><strong>âœ“âœ“ Sozial:</strong> Faire Arbeitsbedingungen, konfliktfreie Materialien</p><p><em>ğŸ’¡ Beste Wahl bei Neukauf! Fairphone berÃ¼cksichtigt alle drei Nachhaltigkeitsaspekte.</em></p>'
                }
            },
            2: { // Kleidung
                'fastfashion': {
                    badges: ['economic'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Fast Fashion</h4><p><strong>âœ“ Ã–konomisch:</strong> Sehr gÃ¼nstig, erschwinglich</p><p><strong>âœ—âœ— Ã–kologisch:</strong> Hoher Wasserverbrauch, Chemikalien, kurze Lebensdauer, viel Abfall</p><p><strong>âœ—âœ— Sozial:</strong> Oft menschenunwÃ¼rdige Arbeitsbedingungen, NiedrigstlÃ¶hne</p><p><em>ğŸ’¡ Wussten Sie? FÃ¼r ein T-Shirt werden ca. 2.700 Liter Wasser benÃ¶tigt!</em></p>'
                },
                'marke': {
                    badges: ['economic'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Marken-Jacke</h4><p><strong>âœ“ Ã–konomisch:</strong> Langfristige Investition, gute QualitÃ¤t, lange Lebensdauer</p><p><strong>~ Ã–kologisch:</strong> LÃ¤nger nutzbar als Fast Fashion, aber trotzdem Neuproduktion</p><p><strong>~ Sozial:</strong> Variiertje nach Marke - nicht alle Marken produzieren fair</p><p><em>ğŸ’¡ Tipp: Achten Sie auf Nachhaltigkeits-Zertifikate wie GOTS oder Fair Wear Foundation.</em></p>'
                },
                'brockenstube': {
                    badges: ['ecological', 'economic', 'social'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Brockenstube</h4><p><strong>âœ“âœ“ Ã–kologisch:</strong> Keine Neuproduktion, verlÃ¤ngerte Lebensdauer, kein zusÃ¤tzlicher Ressourcenverbrauch</p><p><strong>âœ“âœ“ Ã–konomisch:</strong> Sehr gÃ¼nstig, gutes Preis-Leistungs-VerhÃ¤ltnis</p><p><strong>âœ“âœ“ Sozial:</strong> UnterstÃ¼tzt oft soziale Projekte und gemeinnÃ¼tzige Organisationen</p><p><em>ğŸ’¡ Hervorragende Wahl! Second-Hand-Kleidung spart bis zu 80% COâ‚‚.</em></p>'
                },
                'tausch': {
                    badges: ['ecological', 'social'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Kleidertausch</h4><p><strong>âœ“âœ“ Ã–kologisch:</strong> Perfekte Kreislaufwirtschaft, null neue Ressourcen</p><p><strong>âœ“ Ã–konomisch:</strong> Komplett kostenlos</p><p><strong>âœ“âœ“ Sozial:</strong> StÃ¤rkt Gemeinschaft, fÃ¶rdert Teilen statt Besitzen</p><p><em>ğŸ’¡ Perfekt! Kleidertausch ist die nachhaltigste Option Ã¼berhaupt.</em></p>'
                },
                'fairtrade': {
                    badges: ['ecological', 'social'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Fair Trade Mode</h4><p><strong>âœ“âœ“ Ã–kologisch:</strong> Bio-Materialien, umweltschonende Produktion, langlebig</p><p><strong>~ Ã–konomisch:</strong> HÃ¶herer Preis, aber faire Bezahlung entlang der Lieferkette</p><p><strong>âœ“âœ“ Sozial:</strong> Faire LÃ¶hne, gute Arbeitsbedingungen, keine Kinderarbeit</p><p><em>ğŸ’¡ Sehr gute Wahl bei Neukauf! Fair Trade berÃ¼cksichtigt Mensch und Umwelt.</em></p>'
                }
            },
            3: { // Putzmittel
                'standard': {
                    badges: [],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Standard-Putzmittel</h4><p><strong>âœ“ Ã–konomisch:</strong> GÃ¼nstig und Ã¼berall verfÃ¼gbar</p><p><strong>âœ—âœ— Ã–kologisch:</strong> Oft chemische Inhaltsstoffe, Plastikverpackung, belastet GewÃ¤sser</p><p><strong>âœ— Sozial:</strong> Keine besonderen sozialen Aspekte</p><p><em>ğŸ’¡ Bedenken Sie: Viele Putzmittel enthalten Mikroplastik und schÃ¤dliche Chemikalien.</em></p>'
                },
                'marke-plastik': {
                    badges: ['economic'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Marken-Putzmittel</h4><p><strong>âœ“ Ã–konomisch:</strong> Gute Reinigungswirkung, ergiebig</p><p><strong>âœ— Ã–kologisch:</strong> Plastikverpackung, oft chemische Inhaltsstoffe</p><p><strong>~ Sozial:</strong> Keine besonderen sozialen Aspekte</p><p><em>ğŸ’¡ Tipp: Auch teure Marken sind nicht automatisch umweltfreundlicher.</em></p>'
                },
                'bio': {
                    badges: ['ecological', 'social'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Bio-Putzmittel</h4><p><strong>âœ“âœ“ Ã–kologisch:</strong> Biologisch abbaubar, keine Mikroplastik, oft ohne Plastik verpackt</p><p><strong>~ Ã–konomisch:</strong> Etwas teurer, aber oft konzentrierter und ergiebiger</p><p><strong>âœ“ Sozial:</strong> Oft faire Produktion, gesÃ¼nder fÃ¼r Anwender</p><p><em>ğŸ’¡ Sehr gute Wahl! Bio-Putzmittel schÃ¼tzen GewÃ¤sser und Gesundheit.</em></p>'
                },
                'refill': {
                    badges: ['ecological', 'economic', 'social'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: NachfÃ¼llstation</h4><p><strong>âœ“âœ“ Ã–kologisch:</strong> Kein VerpackungsmÃ¼ll, reduzierter Transport, wiederverwendbare BehÃ¤lter</p><p><strong>âœ“ Ã–konomisch:</strong> Oft gÃ¼nstiger pro Liter, langfristig Geld sparen</p><p><strong>âœ“ Sozial:</strong> UnterstÃ¼tzt lokale Unverpackt-LÃ¤den, Zero-Waste-Bewegung</p><p><em>ğŸ’¡ Exzellente Wahl! Refill-Systeme vermeiden bis zu 95% VerpackungsmÃ¼ll.</em></p>'
                },
                'selbst': {
                    badges: ['ecological', 'economic'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Selbst herstellen</h4><p><strong>âœ“âœ“ Ã–kologisch:</strong> NatÃ¼rliche Zutaten, keine Chemikalien, minimaler VerpackungsmÃ¼ll</p><p><strong>âœ“âœ“ Ã–konomisch:</strong> Sehr gÃ¼nstig, Zutaten sind preiswert</p><p><strong>âœ“ Sozial:</strong> GesÃ¼nder fÃ¼r Sie und Ihre Familie</p><p><em>ğŸ’¡ Perfekt! Mit Essig, Natron und ZitronensÃ¤ure reinigen Sie alles natÃ¼rlich und gÃ¼nstig.</em></p>'
                }
            },
            4: { // Festessen
                'steak': {
                    badges: [],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Importiertes Rindfleisch</h4><p><strong>~ Ã–konomisch:</strong> UnterstÃ¼tzt internationale Landwirtschaft</p><p><strong>âœ—âœ— Ã–kologisch:</strong> Sehr hoher COâ‚‚-FuÃŸabdruck (15kg COâ‚‚ pro kg Rindfleisch), langer Transport, Regenwaldabholzung</p><p><strong>âœ— Sozial:</strong> Oft problematische Arbeitsbedingungen</p><p><em>ğŸ’¡ Wussten Sie? Rindfleisch hat den hÃ¶chsten COâ‚‚-FuÃŸabdruck aller Lebensmittel.</em></p>'
                },
                'bio-fleisch': {
                    badges: ['ecological', 'economic', 'social'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Regionales Bio-Fleisch</h4><p><strong>âœ“ Ã–kologisch:</strong> Artgerechte Haltung, weniger Emissionen als konventionell, kurze Transportwege</p><p><strong>âœ“ Ã–konomisch:</strong> UnterstÃ¼tzt lokale Bauern, hÃ¶here QualitÃ¤t</p><p><strong>âœ“ Sozial:</strong> Faire Arbeitsbedingungen, Tierwohl</p><p><em>ğŸ’¡ Gute Wahl! Wenn Fleisch, dann bio und regional. Aber in MaÃŸen genieÃŸen.</em></p>'
                },
                'fisch': {
                    badges: ['economic'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Fisch</h4><p><strong>~ Ã–konomisch:</strong> Je nach Herkunft unterschiedlich</p><p><strong>~ Ã–kologisch:</strong> Besser als Rindfleisch, aber: Ãœberfischung ist ein Problem. Achten Sie auf MSC-Siegel</p><p><strong>~ Sozial:</strong> AbhÃ¤ngig von Fangmethode und Herkunft</p><p><em>ğŸ’¡ Tipp: Schweizer Forelle oder Bio-Lachs aus Europa sind bessere Optionen.</em></p>'
                },
                'vegetarisch': {
                    badges: ['ecological', 'economic', 'social'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Vegetarisches MenÃ¼</h4><p><strong>âœ“âœ“ Ã–kologisch:</strong> Deutlich geringerer COâ‚‚-FuÃŸabdruck (ca. 75% weniger als Fleisch), weniger Wasserverbrauch</p><p><strong>âœ“ Ã–konomisch:</strong> Regionales GemÃ¼se ist oft gÃ¼nstiger, unterstÃ¼tzt lokale Landwirtschaft</p><p><strong>âœ“ Sozial:</strong> Gesund, nachhaltig, tierleidfrei</p><p><em>ğŸ’¡ Hervorragend! Vegetarische ErnÃ¤hrung ist eine der wirksamsten Klimaschutz-MaÃŸnahmen.</em></p>'
                },
                'vegan': {
                    badges: ['ecological', 'economic', 'social'],
                    feedback: '<h4>ğŸ“Š Nachhaltigkeits-Analyse: Veganes Festessen</h4><p><strong>âœ“âœ“ Ã–kologisch:</strong> Geringster COâ‚‚-FuÃŸabdruck (bis zu 90% weniger als Fleisch), minimal Wasserverbrauch, regional und saisonal</p><p><strong>âœ“ Ã–konomisch:</strong> Saisonales GemÃ¼se ist gÃ¼nstig, unterstÃ¼tzt lokale Bio-Landwirtschaft</p><p><strong>âœ“âœ“ Sozial:</strong> Maximal ressourcenschonend, gesund, gerecht</p><p><em>ğŸ’¡ Perfekt! Vegane ErnÃ¤hrung ist die nachhaltigste Option fÃ¼r Mensch, Tier und Klima.</em></p>'
                }
            }
        };

        function selectOption(situation, option) {
            // Remove previous selection
            document.querySelectorAll(`#situation-${situation} .option-card`).forEach(card => {
                card.classList.remove('selected');
            });

            // Add selection to clicked card
            event.target.closest('.option-card').classList.add('selected');

            // Store selection
            selectedOptions[situation] = option;

            // Hide previous feedback
            const feedbackBox = document.getElementById(`feedback-${situation}`);
            feedbackBox.classList.remove('show');
            feedbackBox.innerHTML = '';

            // Reset and enable analyze button
            const analyzeBtn = document.getElementById(`analyze-${situation}`);
            analyzeBtn.disabled = false;
            analyzeBtn.textContent = 'Meine Wahl analysieren';
            analyzeBtn.style.background = 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)';
            
            // If it was counted before, we need to uncount it
            if (analyzeBtn.classList.contains('counted')) {
                analyzeBtn.classList.remove('counted');
                analyzedCount--;
                updateProgress();
            }
        }

        function analyzeChoice(situation) {
            const option = selectedOptions[situation];
            if (!option) {
                alert('Bitte wÃ¤hlen Sie zuerst eine Option aus.');
                return;
            }

            const data = optionData[situation][option];
            const feedbackBox = document.getElementById(`feedback-${situation}`);
            const analyzeBtn = document.getElementById(`analyze-${situation}`);

            // Show feedback
            feedbackBox.innerHTML = data.feedback;

            // Add badges
            const badgesHtml = `
                <div class="sustainability-badges">
                    <div class="badge ecological ${data.badges.includes('ecological') ? '' : 'inactive'}">ğŸŒ¿ Ã–kologisch</div>
                    <div class="badge economic ${data.badges.includes('economic') ? '' : 'inactive'}">ğŸ’° Ã–konomisch</div>
                    <div class="badge social ${data.badges.includes('social') ? '' : 'inactive'}">ğŸ‘¥ Sozial</div>
                </div>
            `;

            feedbackBox.innerHTML = badgesHtml + feedbackBox.innerHTML;
            feedbackBox.classList.add('show');

            // Disable analyze button
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'âœ“ Analysiert';
            analyzeBtn.style.background = '#10b981';

            // Update progress
            if (!analyzeBtn.classList.contains('counted')) {
                analyzedCount++;
                analyzeBtn.classList.add('counted');
                updateProgress();
            }
        }

        function updateProgress() {
            document.getElementById('progressDisplay').textContent = `${analyzedCount} / 4 Situationen analysiert`;
        }

        function autoSave() {
            const data = {
                s1_idea: document.getElementById('s1-idea').value,
                s1_reflection: document.getElementById('s1-reflection').value,
                s2_idea: document.getElementById('s2-idea').value,
                s2_reflection: document.getElementById('s2-reflection').value,
                s3_idea: document.getElementById('s3-idea').value,
                s3_reflection: document.getElementById('s3-reflection').value,
                s4_idea: document.getElementById('s4-idea').value,
                s4_reflection: document.getElementById('s4-reflection').value,
                selectedOptions: selectedOptions,
                analyzedCount: analyzedCount
            };

            let progress = JSON.parse(localStorage.getItem('learningProgressKonsum') || '{"completedPoints":[],"currentPoint":1,"texts":{},"images":{}}');
            if (!progress.texts) progress.texts = {};
            progress.texts['4'] = JSON.stringify(data);
            localStorage.setItem('learningProgressKonsum', JSON.stringify(progress));
        }

        function loadData() {
            const progress = JSON.parse(localStorage.getItem('learningProgressKonsum') || '{"completedPoints":[],"currentPoint":1,"texts":{},"images":{}}');
            if (progress.texts && progress.texts['4']) {
                const data = JSON.parse(progress.texts['4']);
                
                if (data.s1_idea) document.getElementById('s1-idea').value = data.s1_idea;
                if (data.s1_reflection) document.getElementById('s1-reflection').value = data.s1_reflection;
                if (data.s2_idea) document.getElementById('s2-idea').value = data.s2_idea;
                if (data.s2_reflection) document.getElementById('s2-reflection').value = data.s2_reflection;
                if (data.s3_idea) document.getElementById('s3-idea').value = data.s3_idea;
                if (data.s3_reflection) document.getElementById('s3-reflection').value = data.s3_reflection;
                if (data.s4_idea) document.getElementById('s4-idea').value = data.s4_idea;
                if (data.s4_reflection) document.getElementById('s4-reflection').value = data.s4_reflection;

                if (data.selectedOptions) selectedOptions = data.selectedOptions;
                if (data.analyzedCount) {
                    analyzedCount = data.analyzedCount;
                    updateProgress();
                }
            }
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFont("helvetica", "bold");
            doc.setFontSize(20);
            doc.text("Lernjournal: Nachhaltiges Konsumverhalten", 20, 20);

            doc.setFont("helvetica", "normal");
            doc.setFontSize(11);
            doc.text(`Datum: ${new Date().toLocaleDateString('de-DE')}`, 20, 30);
            doc.text(`Analysierte Situationen: ${analyzedCount}/4`, 20, 36);

            let yPos = 50;

            const situations = [
                {num: 1, title: 'Smartphone', idea: 's1-idea', reflection: 's1-reflection'},
                {num: 2, title: 'Kleidung', idea: 's2-idea', reflection: 's2-reflection'},
                {num: 3, title: 'Putzmittel', idea: 's3-idea', reflection: 's3-reflection'},
                {num: 4, title: 'Festtagsessen', idea: 's4-idea', reflection: 's4-reflection'}
            ];

            situations.forEach(sit => {
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }

                doc.setFont("helvetica", "bold");
                doc.setFontSize(14);
                doc.text(`Situation ${sit.num}: ${sit.title}`, 20, yPos);
                yPos += 8;

                doc.setFont("helvetica", "normal");
                doc.setFontSize(10);

                const idea = document.getElementById(sit.idea).value;
                if (idea) {
                    doc.text("Erste Idee:", 20, yPos);
                    yPos += 5;
                    const ideaLines = doc.splitTextToSize(idea, 170);
                    ideaLines.forEach(line => {
                        if (yPos > 280) {
                            doc.addPage();
                            yPos = 20;
                        }
                        doc.text(line, 25, yPos);
                        yPos += 5;
                    });
                    yPos += 3;
                }

                const reflection = document.getElementById(sit.reflection).value;
                if (reflection) {
                    doc.text("Reflexion:", 20, yPos);
                    yPos += 5;
                    const refLines = doc.splitTextToSize(reflection, 170);
                    refLines.forEach(line => {
                        if (yPos > 280) {
                            doc.addPage();
                            yPos = 20;
                        }
                        doc.text(line, 25, yPos);
                        yPos += 5;
                    });
                }

                yPos += 8;
            });

            doc.save('Lernjournal_Schritt4_Nachhaltiges_Konsumverhalten.pdf');
        }

        function completeStep() {
            if (analyzedCount < 4) {
                const confirm = window.confirm(`Sie haben bisher ${analyzedCount} von 4 Situationen analysiert. MÃ¶chten Sie den Schritt trotzdem abschlieÃŸen?`);
                if (!confirm) return;
            }

            autoSave();

            let progress = JSON.parse(localStorage.getItem('learningProgressKonsum') || '{"completedPoints":[],"currentPoint":1,"texts":{},"images":{}}');

            if (!progress.completedPoints.includes(4)) {
                progress.completedPoints.push(4);
                progress.currentPoint = 5;
                localStorage.setItem('learningProgressKonsum', JSON.stringify(progress));
            }

            alert(`âœ“ Schritt 4 abgeschlossen!\n\nSie haben ${analyzedCount} von 4 Situationen analysiert.`);
            window.location.href = 'index.html';
        }

        function returnToMain() {
            autoSave();
            window.location.href = 'index.html';
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>
