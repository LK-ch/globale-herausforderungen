<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schritt 2: Planetare Belastungsgrenzen</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fbbf24 0%, #fb923c 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .lesson-header {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
            color: white;
            padding: 40px;
            border-radius: 20px 20px 0 0;
        }

        .lesson-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .lesson-content {
            padding: 40px;
            line-height: 1.8;
        }

        .info-box {
            background: #fef3c7;
            border-left: 4px solid #fb923c;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .info-box p {
            color: #78350f;
        }

        h2 {
            color: #f97316;
            margin: 30px 0 15px 0;
            font-size: 1.6em;
        }

        .btn-back-header {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border: 2px solid white;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-block;
            text-decoration: none;
            margin-bottom: 20px;
        }

        .btn-back-header:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* Video Container */
        .video-container {
            background: #fff7ed;
            border: 3px solid #fb923c;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }

        .video-container h3 {
            color: #f97316;
            margin-bottom: 15px;
        }

        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            overflow: hidden;
            border-radius: 10px;
            margin-top: 15px;
        }

        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Questions Styling */
        .questions-container {
            background: #fff7ed;
            border: 3px solid #fb923c;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }

        .question-block {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .question-number {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
            color: white;
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.15em;
            font-weight: bold;
            color: #78350f;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* Multiple Choice */
        .mc-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .mc-option {
            background: #fef3c7;
            border: 2px solid #fde68a;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }

        .mc-option:hover:not(.disabled) {
            border-color: #fb923c;
            background: #fde68a;
            transform: translateX(5px);
        }

        .mc-option input[type="radio"] {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .mc-option.correct {
            background: #d1fae5;
            border-color: #10b981;
        }

        .mc-option.incorrect {
            background: #fee2e2;
            border-color: #ef4444;
        }

        .mc-option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Text Input */
        .text-input-wrapper {
            margin: 15px 0;
        }

        .text-input {
            width: 100%;
            max-width: 400px;
            padding: 12px;
            border: 2px solid #fde68a;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .text-input:focus {
            outline: none;
            border-color: #fb923c;
        }

        .text-input.correct {
            border-color: #10b981;
            background: #d1fae5;
        }

        .text-input.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
        }

        /* Check Button */
        .check-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.2s;
        }

        .check-btn:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .check-btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }

        /* Feedback */
        .feedback {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            display: none;
            font-weight: bold;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .feedback.incorrect {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }

        /* Score Display */
        .score-display {
            background: white;
            border: 3px solid #fb923c;
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
        }

        .score-display h3 {
            color: #f97316;
            margin-bottom: 10px;
        }

        .score-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #fb923c;
        }

        /* Portfolio Box */
        .portfolio-box {
            background: #fef3c7;
            border: 3px solid #fb923c;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }

        .portfolio-box h3 {
            color: #f97316;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .portfolio-box textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #fde68a;
            border-radius: 10px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1em;
            resize: vertical;
            margin-bottom: 15px;
        }

        .portfolio-box textarea:focus {
            outline: none;
            border-color: #fb923c;
            box-shadow: 0 0 10px rgba(251, 146, 60, 0.2);
        }

        .saved-indicator {
            color: #f97316;
            font-weight: bold;
            display: none;
            margin-top: 10px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        button:hover {
            transform: scale(1.05);
        }

        .btn-back {
            background: #f5f5f5;
            color: #333;
        }

        .btn-complete {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
            color: white;
        }

        .btn-pdf {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .btn-save {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 12px 30px;
        }

        .hint-text {
            font-size: 0.9em;
            color: #92400e;
            font-style: italic;
            margin-top: 8px;
        }

        /* Checkbox Styling */
        .checkbox-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .checkbox-option {
            background: #fef3c7;
            border: 2px solid #fde68a;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }

        .checkbox-option:hover:not(.disabled) {
            border-color: #fb923c;
            background: #fde68a;
        }

        .checkbox-option input[type="checkbox"] {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-option.correct {
            background: #d1fae5;
            border-color: #10b981;
        }

        .checkbox-option.incorrect {
            background: #fee2e2;
            border-color: #ef4444;
        }

        /* Dropdown Styling */
        .dropdown-select {
            width: 100%;
            max-width: 500px;
            padding: 12px;
            border: 2px solid #fde68a;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
            cursor: pointer;
        }

        .dropdown-select:focus {
            outline: none;
            border-color: #fb923c;
        }

        .dropdown-select.correct {
            border-color: #10b981;
            background: #d1fae5;
        }

        .dropdown-select.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
        }

        /* Cloze Text Styling */
        .cloze-text {
            background: #fef3c7;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .cloze-input {
            padding: 8px;
            border: 2px solid #fde68a;
            border-radius: 5px;
            font-size: 1em;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
        }

        .cloze-input:focus {
            outline: none;
            border-color: #fb923c;
        }

        .cloze-input.correct {
            border-color: #10b981;
            background: #d1fae5;
        }

        .cloze-input.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
        }

        /* Sorting Styling */
        .sorting-area {
            background: #fef3c7;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .sorting-instructions {
            color: #78350f;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .sortable-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sortable-item {
            background: white;
            border: 2px solid #fde68a;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .sortable-item.correct {
            background: #d1fae5;
            border-color: #10b981;
        }

        .sortable-item.incorrect {
            background: #fee2e2;
            border-color: #ef4444;
        }

        .item-text {
            font-weight: bold;
            color: #78350f;
            flex: 1;
        }

        .sort-buttons {
            display: flex;
            gap: 5px;
        }

        .sort-btn {
            background: #fb923c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }

        .sort-btn:hover {
            background: #f97316;
            transform: scale(1.1);
        }

        .sort-btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .lesson-header h1 {
                font-size: 1.8em;
            }

            .lesson-content {
                padding: 20px;
            }

            .video-container, .questions-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="lesson-header">
            <button class="btn-back-header" onclick="returnToMain()">‚Üê Zur√ºck zur √úbersicht</button>
            <h1>üåç Planetare Belastungsgrenzen</h1>
        </div>

        <div class="lesson-content">
            <div class="info-box">
                <p><strong>üìã Aufgabe:</strong> Schauen Sie sich das Video aufmerksam an und beantworten Sie anschliessend die Fragen. H√∂ren Sie genau hin - die Antworten sind nicht immer offensichtlich!</p>
            </div>

            <div class="video-container">
                <h3>üé• Video: Planetare Belastungsgrenzen erkl√§rt</h3>
                <p style="color: #78350f; margin-bottom: 15px;">
                    Schauen Sie sich das Video mindestens einmal vollst√§ndig an, bevor Sie mit den Fragen beginnen.
                </p>
                <div class="video-wrapper">
                    <iframe 
                        src="https://www.youtube.com/embed/m1nBEOfNFIE" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                </div>
                <p class="hint-text">üí° Tipp: Sie k√∂nnen das Video jederzeit zur√ºckspulen, um Details nochmals anzuh√∂ren.</p>
            </div>

            <h2>üìù H√∂rverstehen: Fragen zum Video</h2>

            <div class="questions-container">
                <div id="current-question-display"></div>

                <div class="score-display">
                    <h3>Ihre Punktzahl</h3>
                    <div class="score-number" id="scoreDisplay">0 / 10</div>
                    <p style="color: #78350f; margin-top: 10px;">Frage <span id="questionProgress">1</span> von 10</p>
                </div>
            </div>

            <div class="portfolio-box">
                <h3>üìù Mein Lernjournal: Schritt 2</h3>
                <p style="color: #78350f; margin-bottom: 15px;">
                    <strong>Reflexionsaufgabe:</strong>
                </p>
                <ul style="margin: 10px 0 15px 20px; line-height: 1.8; color: #78350f;">
                    <li>Welche planetare Belastungsgrenze hat Sie am meisten √ºberrascht oder beunruhigt?</li>
                    <li>Was bedeutet es f√ºr Sie pers√∂nlich, dass bereits 6 von 9 Grenzen √ºberschritten sind?</li>
                    <li>Welche Ver√§nderungen in Wirtschaft und Gesellschaft halten Sie f√ºr am dringendsten?</li>
                </ul>
                <textarea 
                    id="portfolio-text" 
                    placeholder="Hier Ihre Notizen eintragen..."
                    oninput="savePortfolio()"></textarea>
                <div class="saved-indicator" id="saved-indicator">‚úì Automatisch gespeichert</div>
                
                <button class="btn-save" onclick="savePortfolioManual()">
                    üíæ Speichern
                </button>
            </div>

            <div class="button-group">
                <button class="btn-back" onclick="returnToMain()">
                    ‚Üê Zur√ºck zur √úbersicht
                </button>
                <button class="btn-pdf" onclick="downloadPDF()">
                    üìÑ PDF Schritt 2 herunterladen
                </button>
                <button class="btn-complete" onclick="completeStep()">
                    Schritt abschliessen und weiter ‚Üí
                </button>
            </div>
        </div>
    </div>

    <script>
        let score = 0;
        let answeredQuestions = new Set();

        // Sorting Functions
        function moveUp(button, event) {
            event.preventDefault();
            const item = button.closest('.sortable-item');
            const prev = item.previousElementSibling;
            if (prev) {
                item.parentNode.insertBefore(item, prev);
            }
        }

        function moveDown(button, event) {
            event.preventDefault();
            const item = button.closest('.sortable-item');
            const next = item.nextElementSibling;
            if (next) {
                item.parentNode.insertBefore(next, item);
            }
        }

        function checkQuestion(questionNum, type, correctAnswer) {
            if (answeredQuestions.has(questionNum)) {
                return;
            }

            const feedback = document.getElementById(`feedback-${questionNum}`);
            const button = document.querySelector(`[data-question="${questionNum}"] .check-btn`);
            let isCorrect = false;

            if (type === 'mc') {
                const selected = document.querySelector(`input[name="q${questionNum}"]:checked`);
                if (!selected) {
                    alert('Bitte w√§hlen Sie eine Antwort aus.');
                    return;
                }
                const userAnswer = selected.value;
                isCorrect = userAnswer === correctAnswer;

                const options = document.querySelectorAll(`input[name="q${questionNum}"]`);
                options.forEach(opt => {
                    opt.disabled = true;
                    opt.parentElement.classList.add('disabled');
                });

                if (isCorrect) {
                    selected.parentElement.classList.add('correct');
                } else {
                    selected.parentElement.classList.add('incorrect');
                    options.forEach(opt => {
                        if (opt.value === correctAnswer) {
                            opt.parentElement.classList.add('correct');
                        }
                    });
                }
            } 
            else if (type === 'text') {
                const input = document.getElementById(`q${questionNum}-input`);
                const userAnswer = input.value.trim().toLowerCase();
                
                if (userAnswer === '') {
                    alert('Bitte geben Sie eine Antwort ein.');
                    return;
                }

                const correctAnswers = Array.isArray(correctAnswer) ? correctAnswer : [correctAnswer];
                isCorrect = correctAnswers.some(ans => 
                    userAnswer === ans.toLowerCase() || 
                    userAnswer.includes(ans.toLowerCase())
                );

                input.disabled = true;
                input.classList.add(isCorrect ? 'correct' : 'incorrect');
            }
            else if (type === 'checkbox') {
                const checked = Array.from(document.querySelectorAll(`input[name="q${questionNum}"]:checked`))
                    .map(cb => cb.value);
                
                if (checked.length === 0) {
                    alert('Bitte w√§hlen Sie mindestens eine Antwort aus.');
                    return;
                }

                const correctSet = new Set(correctAnswer);
                const checkedSet = new Set(checked);
                isCorrect = correctSet.size === checkedSet.size && 
                           [...correctSet].every(val => checkedSet.has(val));

                const allCheckboxes = document.querySelectorAll(`input[name="q${questionNum}"]`);
                allCheckboxes.forEach(cb => {
                    cb.disabled = true;
                    if (correctAnswer.includes(cb.value)) {
                        cb.parentElement.classList.add('correct');
                    } else if (checked.includes(cb.value)) {
                        cb.parentElement.classList.add('incorrect');
                    }
                });
            }
            else if (type === 'dropdown') {
                const select = document.getElementById(`q${questionNum}-select`);
                const userAnswer = select.value;
                
                if (userAnswer === '') {
                    alert('Bitte w√§hlen Sie eine Antwort aus.');
                    return;
                }

                isCorrect = userAnswer === correctAnswer;
                select.disabled = true;
                select.classList.add(isCorrect ? 'correct' : 'incorrect');
            }
            else if (type === 'cloze') {
                let allCorrect = true;
                const inputs = Object.keys(correctAnswer);
                
                for (let key of inputs) {
                    const input = document.getElementById(`q${questionNum}${key}-input`);
                    const userAnswer = input.value.trim().toLowerCase();
                    
                    if (userAnswer === '') {
                        alert('Bitte f√ºllen Sie alle L√ºcken aus.');
                        return;
                    }

                    const correctAnswers = Array.isArray(correctAnswer[key]) ? correctAnswer[key] : [correctAnswer[key]];
                    const inputCorrect = correctAnswers.some(ans => 
                        userAnswer === ans.toLowerCase()
                    );

                    input.disabled = true;
                    input.classList.add(inputCorrect ? 'correct' : 'incorrect');
                    
                    if (!inputCorrect) allCorrect = false;
                }
                
                isCorrect = allCorrect;
            }
            else if (type === 'sorting') {
                const items = document.querySelectorAll('.sortable-item');
                const currentOrder = Array.from(items).map(item => parseInt(item.dataset.id));
                isCorrect = JSON.stringify(currentOrder) === JSON.stringify(correctAnswer);

                items.forEach((item, index) => {
                    const buttons = item.querySelectorAll('.sort-btn');
                    buttons.forEach(btn => btn.disabled = true);
                    
                    if (parseInt(item.dataset.id) === correctAnswer[index]) {
                        item.classList.add('correct');
                    } else {
                        item.classList.add('incorrect');
                    }
                });
            }

            if (isCorrect) {
                score++;
                feedback.className = 'feedback correct show';
                feedback.innerHTML = '<strong>‚úì Richtig!</strong> Sehr gut!';
            } else {
                feedback.className = 'feedback incorrect show';
                
                // Spezifische Feedbacks f√ºr jede Frage
                if (questionNum === 2) {
                    feedback.innerHTML = `<strong>‚úó Leider falsch.</strong> Die richtige Antwort lautet: <strong>"Planetare Belastbarkeitsgrenzen"</strong> (oder "Planetare Belastungsgrenzen")`;
                } else if (questionNum === 4) {
                    feedback.innerHTML = '<strong>‚úó Leider falsch.</strong> Die drei im Video explizit genannten Grenzen sind: <strong>Ozonloch, Verlust von Biodiversit√§t, Klimaerw√§rmung</strong>';
                } else if (questionNum === 5) {
                    feedback.innerHTML = '<strong>‚úó Leider falsch.</strong> Die richtige Antwort: <strong>"4"</strong> von neun Grenzen sind √ºberschritten, wir verlassen den sicheren <strong>"Handlungsraum"</strong>';
                } else if (questionNum === 6) {
                    feedback.innerHTML = '<strong>‚úó Leider falsch.</strong> Die richtige Antwort: <strong>Bakterien verbrauchen den Sauerstoff im Wasser</strong> ‚Äì dadurch sterben Meerestiere wie Fische und Krebse oder m√ºssen abwandern';
                } else if (questionNum === 8) {
                    feedback.innerHTML = '<strong>‚úó Leider falsch.</strong> Die korrekte Reihenfolge im Video: <strong>1. Finanzbereich, 2. Politik, 3. Wirtschaft, 4. Gesellschaft</strong>';
                } else if (questionNum === 9) {
                    feedback.innerHTML = '<strong>‚úó Leider falsch.</strong> Die drei richtigen Antworten sind: <strong>(1)</strong> Investitionsentscheide ohne fossile Energietr√§ger, <strong>(2)</strong> Unternehmen mit nachhaltigen Gesch√§ftsmodellen, <strong>(3)</strong> Konsumenten, die hinterfragen was sie wirklich brauchen';
                } else if (questionNum === 10) {
                    feedback.innerHTML = '<strong>‚úó Leider falsch.</strong> Die richtige Antwort: Wir haben nur eine <strong>"Erde"</strong>, aber unsere <strong>"Kreativit√§t"</strong> und Innovationskraft ist unersch√∂pflich';
                } else if (type === 'text') {
                    const correctAnswerText = Array.isArray(correctAnswer) ? correctAnswer[0] : correctAnswer;
                    feedback.innerHTML = `<strong>‚úó Leider falsch.</strong> Die richtige Antwort: <strong>"${correctAnswerText}"</strong>`;
                } else if (type === 'sorting') {
                    feedback.innerHTML = '<strong>‚úó Leider falsch.</strong> Die korrekte Reihenfolge: <strong>Finanzbereich, Politik, Wirtschaft, Gesellschaft</strong>';
                } else if (type === 'checkbox') {
                    feedback.innerHTML = '<strong>‚úó Leider falsch.</strong> Die richtigen Antworten wurden <span style="color: #10b981;">gr√ºn</span> markiert.';
                } else {
                    feedback.innerHTML = '<strong>‚úó Leider falsch.</strong> Die richtige Antwort wurde <span style="color: #10b981;">gr√ºn</span> markiert.';
                }
            }

            answeredQuestions.add(questionNum);
            button.disabled = true;
            document.getElementById('scoreDisplay').textContent = `${score} / 10`;
        }

        function loadPortfolio() {
            const saved = localStorage.getItem('learningProgressKonsum');
            if (saved) {
                const progress = JSON.parse(saved);
                const portfolioText = progress.texts && progress.texts['2'] ? progress.texts['2'] : '';
                document.getElementById('portfolio-text').value = portfolioText;
            }
        }

        function savePortfolio() {
            const text = document.getElementById('portfolio-text').value;
            
            let progress = {
                completedPoints: [],
                currentPoint: 1,
                texts: {},
                images: {}
            };
            
            const saved = localStorage.getItem('learningProgressKonsum');
            if (saved) {
                progress = JSON.parse(saved);
            }
            
            if (!progress.texts) {
                progress.texts = {};
            }
            
            progress.texts['2'] = text;
            
            localStorage.setItem('learningProgressKonsum', JSON.stringify(progress));
            
            const indicator = document.getElementById('saved-indicator');
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);
        }

        function savePortfolioManual() {
            const text = document.getElementById('portfolio-text').value.trim();
            
            if (text === '') {
                alert('‚ö†Ô∏è Bitte tragen Sie zuerst Ihre Notizen ein.');
                return;
            }
            
            savePortfolio();
            
            const indicator = document.getElementById('saved-indicator');
            indicator.style.display = 'block';
            indicator.textContent = '‚úì Erfolgreich gespeichert!';
            setTimeout(() => {
                indicator.style.display = 'none';
                indicator.textContent = '‚úì Automatisch gespeichert';
            }, 3000);
        }

        function downloadPDF() {
            const portfolioText = document.getElementById('portfolio-text').value.trim();
            
            if (portfolioText === '') {
                alert('Bitte tragen Sie zuerst Ihre Reflexion in das Lernjournal ein.');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFont("helvetica", "bold");
            doc.setFontSize(20);
            doc.text("Lernjournal: Planetare Belastungsgrenzen", 20, 20);
            
            doc.setFont("helvetica", "normal");
            doc.setFontSize(11);
            doc.text(`Datum: ${new Date().toLocaleDateString('de-DE')}`, 20, 30);
            doc.text(`Erreichte Punktzahl: ${score}/10`, 20, 36);
            
            let yPos = 50;
            
            doc.setFont("helvetica", "bold");
            doc.setFontSize(14);
            doc.text("Meine Reflexion:", 20, yPos);
            yPos += 8;
            
            doc.setFont("helvetica", "normal");
            doc.setFontSize(11);
            const lines = doc.splitTextToSize(portfolioText, 170);
            
            for (let line of lines) {
                if (yPos > 280) {
                    doc.addPage();
                    yPos = 20;
                }
                doc.text(line, 20, yPos);
                yPos += 7;
            }
            
            doc.save('Lernjournal_Schritt2_Hoerverstehen.pdf');
        }

        function completeStep() {
            const portfolioText = document.getElementById('portfolio-text').value.trim();
            
            if (answeredQuestions.size < 10) {
                alert(`‚ö†Ô∏è Bitte beantworten Sie zuerst alle Fragen!\n\nSie haben bisher ${answeredQuestions.size} von 10 Fragen beantwortet.`);
                return;
            }
            
            if (portfolioText === '') {
                const confirm = window.confirm('Sie haben noch nichts in Ihr Lernjournal eingetragen. M√∂chten Sie trotzdem fortfahren?');
                if (!confirm) return;
            }
            
            if (portfolioText !== '') {
                savePortfolio();
            }
            
            let progress = JSON.parse(localStorage.getItem('learningProgressKonsum') || '{"completedPoints":[],"currentPoint":1,"texts":{},"images":{}}');
            
            if (!progress.completedPoints.includes(2)) {
                progress.completedPoints.push(2);
                progress.currentPoint = 3;
                localStorage.setItem('learningProgressKonsum', JSON.stringify(progress));
            }
            
            alert(`‚úì Schritt 2 abgeschlossen!\n\nSie haben ${score} von 10 Punkten erreicht.${portfolioText !== '' ? '\nIhr Lernjournal-Eintrag wurde gespeichert.' : ''}`);
            window.location.href = 'index.html';
        }

        function returnToMain() {
            window.location.href = 'index.html';
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadPortfolio();
        });
    </script>
</body>
</html>
